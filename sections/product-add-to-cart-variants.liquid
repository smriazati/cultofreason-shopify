<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>

<div class="product-form form-wrapper bg-dark flex-row link-hover">
    {%- assign product_form_id = 'product-form-' | append: section.id -%}

    <variant-selects class="no-js-hidden" data-section="{{ section.id }}" data-url="{{ product.url }}" {{ block.shopify_attributes }}>
        {%- for option in product.options_with_values -%}
          <div class="product-form__input product-form__input--dropdown">
            <label class="form__label" for="Option-{{ section.id }}-{{ forloop.index0 }}">
              {{ option.name }}
            </label>
            <div class="select">
              <select id="Option-{{ section.id }}-{{ forloop.index0 }}"
                class="select__select"
                name="options[{{ option.name | escape }}]"
                form="{{ product_form_id }}"
              >
                {%- for value in option.values -%}
                  <option value="{{ value | escape }}" {% if option.selected_value == value %}selected="selected"{% endif %}>
                    {{ value }}
                  </option>
                {%- endfor -%}
              </select>
            </div>
          </div>
        {%- endfor -%}

        <script type="application/json">
          {{ product.variants | json }}
        </script>
      </variant-selects>

      <product-form class="product-form">
        {%- form 'product', product, data-productid: product.id, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
          <input type="hidden" name="id" data-productid="{{ product.id }}" value="{{ product.selected_or_first_available_variant.id }}" disabled>
          <div class="product-form__buttons">
            <button
              type="submit"
              name="add"
              class="product-form__submit flex-row" {% if product.selected_or_first_available_variant.available == false %}disabled{% endif %}
            >
                <div class="flex-row">
                    <span>
                    {%- if product.selected_or_first_available_variant.available -%}
                        Add to Cart - 
                    {%- else -%}
                        Sold out - 
                    {%- endif -%}
                    </span>
                    <span class="ml-4" id="priceInBtn">{{ product.selected_or_first_available_variant.price | money_without_trailing_zeros }}</span>
                </div>
                <div class="loading-overlay__spinner hidden">
                  
                </div>
            </button>

          </div>
        {%- endform -%}
    </product-form>

</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
      function isIE() {
        const ua = window.navigator.userAgent;
        const msie = ua.indexOf('MSIE ');
        const trident = ua.indexOf('Trident/');

        return (msie > 0 || trident > 0);
      }

      if (!isIE()) return;
      const hiddenInput = document.querySelector('#{{ product_form_id }} input[name="id" data-productid="{{ product.id }}"]');      
      const noScriptInputWrapper = document.createElement('div');
      const variantSwitcher = document.querySelector('variant-selects[data-section="{{ section.id }}"]');
      noScriptInputWrapper.innerHTML = document.querySelector('.product-form__noscript-wrapper-{{ section.id }}').textContent;
      variantSwitcher.outerHTML = noScriptInputWrapper.outerHTML;

      document.querySelector('#Variants-{{ section.id }}').addEventListener('change', function(event) {
        hiddenInput.value = event.currentTarget.value;
      });
    });
  </script>